server:
  port: 8082

spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/urban-events?currentSchema=priorizacion_incidencias
    username: pguser
    password: localpass
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  
  # Configuración de Spring Cloud Stream
  cloud:
    stream:
      # Definición del binding funcional
      function:
        definition: procesarIncidencia
      
      # Configuración de los bindings
      bindings:
        # Input binding: consume de incidencias.creadas
        procesarIncidencia-in-0:
          destination: incidencias.creadas
          group: priorizacion-service
          consumer:
            max-attempts: 3
            back-off-initial-interval: 1000
        
        # Output binding: produce a incidencias.priorizadas
        procesarIncidencia-out-0:
          destination: incidencias.priorizadas
          producer:
            partition-count: 3
      
      # Configuración específica de Kafka
      kafka:
        binder:
          brokers: localhost:9092
          auto-create-topics: true
          configuration:
            session.timeout.ms: 10000
            request.timeout.ms: 30000
        
        bindings:
          procesarIncidencia-in-0:
            consumer:
              enable-dlq: false
              auto-commit-interval: 100
              start-offset: latest
          
          procesarIncidencia-out-0:
            producer:
              configuration:
                acks: all
                retries: 3
                linger.ms: 10
                batch.size: 16384
                enable.idempotence: true

priorizacion:
  palabras-criticas: incendio, explosion, explosivo, heridos, urgente
  delay-segundos: 4
