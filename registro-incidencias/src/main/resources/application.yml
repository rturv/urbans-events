server:
  port: 8081

spring:
  datasource:
    # Temporal: usar localhost para ejecutar la aplicación localmente
    url: jdbc:postgresql://localhost:5432/urban-events?currentSchema=registro_incidencias
    username: pguser
    password: localpass
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  
  # Configuración de Spring Cloud Stream
  cloud:
    stream:
      # Definición del binding funcional
      function:
        definition: consumirIncidenciaPriorizada
      
      # Configuración de los bindings
      bindings:
        # Input binding: consume de incidencias.priorizadas
        consumirIncidenciaPriorizada-in-0:
          destination: incidencias.priorizadas
          group: registro-service
          consumer:
            max-attempts: 3
            back-off-initial-interval: 1000
        
        # Output binding: produce a incidencias.creadas (para el controlador)
        incidenciasCreadas-out-0:
          destination: incidencias.creadas
          producer:
            partition-count: 3
      
      # Configuración específica de Kafka
      kafka:
        binder:
          brokers: localhost:9092
          auto-create-topics: true
          configuration:
            session.timeout.ms: 10000
            request.timeout.ms: 30000
        
        bindings:
          consumirIncidenciaPriorizada-in-0:
            consumer:
              enable-dlq: false
              auto-commit-interval: 100
              start-offset: latest
          
          incidenciasCreadas-out-0:
            producer:
              configuration:
                acks: all
                retries: 3
                linger.ms: 10
                batch.size: 16384
                enable.idempotence: true

# Variable de compatibilidad para la configuración anterior
kafka:
  bootstrap-servers: localhost:9092
